{% extends "_base.html" %}

{% block title %}ä¼æ¥­ä¸€è¦§ - ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†{% endblock %}

{% block content %}
<div class="user-greeting">
    <p>ã“ã‚“ã«ã¡ã¯ã€<strong>{{ current_user.id }}</strong> ã•ã‚“ï¼</p>
</div>

<div class="keywords-display">
    <p>ğŸ” <strong>Bingæ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:</strong> ã€Œ{{ active_keywords | join(' ') }}ã€</p>
</div>

<h1>ğŸ¢ ä¼æ¥­ä¸€è¦§</h1>

<div class="table-container">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>æ“ä½œ</th>
                <th>ä¼æ¥­å</th>
                <th>ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸</th>
                <th>å•ã„åˆã‚ã›</th>
                <th>ä½æ‰€</th>
                <th>é›»è©±ç•ªå·</th>
                <th>FAX</th>
                <th>ã‚«ãƒ†ã‚´ãƒª</th>
                <th>èª¬æ˜</th>
            </tr>
        </thead>
        <tbody>
            {% for f in forms %}
            <tr>
                <td>
                    <a href="#" class="edit-btn btn btn-sm btn-outline-primary" 
                        data-id="{{ f['_id'] }}"
                        data-name="{{ f.get('company_name', '') }}"
                        data-address="{{ f.get('address', '') }}"
                        data-tel="{{ f.get('tel', '') }}"
                        data-fax="{{ f.get('fax', '') }}"
                        data-category="{{ f.get('category_keywords', '') }}"
                        data-description="{{ f.get('description', '') }}"
                        data-bs-toggle="modal" data-bs-target="#editModal">âœï¸</a>
                    <a href="{{ url_for('delete_company', company_id=f['_id']) }}"
                       onclick="return confirm('ã“ã®ä¼æ¥­ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ');"
                       class="btn btn-sm btn-outline-danger">ğŸ—‘ï¸</a>
                </td>
                <td>{{ f.get("company_name", "æœªè¨­å®š") }}</td>
                <td>{% if f.get('url_top') and f.get('url_top') != '#' %}<a href="{{ f['url_top'] }}" target="_blank">ğŸŒ</a>{% else %}æœªè¨­å®š{% endif %}</td>
                <td>{% if f.get('url_form') and f.get('url_form') != '#' %}<a href="{{ f['url_form'] }}" target="_blank">ğŸ“</a>{% else %}æœªè¨­å®š{% endif %}</td>
                <td>{{ f.get("address", "æœªè¨­å®š") }}</td>
                <td>{{ f.get("tel", "æœªè¨­å®š") }}</td>
                <td>{{ f.get("fax", "æœªè¨­å®š") }}</td>
                <td>{{ f.get("category_keywords", "æœªè¨­å®š") }}</td>
                <td>{{ f.get("description", "æœªè¨­å®š") }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if not forms %}
<div class="text-center text-muted mt-4">
    <p class="lead">ğŸ“ ã¾ã ä¼æ¥­ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
    <p>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦æ¤œç´¢ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚</p>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll(".edit-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.getElementById("edit_id").value = btn.dataset.id;
      document.getElementById("edit_name").value = btn.dataset.name;
      document.getElementById("edit_address").value = btn.dataset.address;
      document.getElementById("edit_tel").value = btn.dataset.tel;
      document.getElementById("edit_fax").value = btn.dataset.fax;
      document.getElementById("edit_category").value = btn.dataset.category;
      document.getElementById("edit_description").value = btn.dataset.description;
    });
  });
});
</script>
{% endblock %}

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ã¯bodyã®æœ€å¾Œã«é…ç½® -->
<div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <form method="POST" action="/update_company">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">âœï¸ ä¼æ¥­æƒ…å ±ã‚’ç·¨é›†</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="company_id" id="edit_id">
          <div class="mb-2"><label>ä¼æ¥­å: <input type="text" class="form-control" name="company_name" id="edit_name"></label></div>
          <div class="mb-2"><label>ä½æ‰€: <input type="text" class="form-control" name="address" id="edit_address"></label></div>
          <div class="mb-2"><label>é›»è©±ç•ªå·: <input type="text" class="form-control" name="tel" id="edit_tel"></label></div>
          <div class="mb-2"><label>FAX: <input type="text" class="form-control" name="fax" id="edit_fax"></label></div>
          <div class="mb-2"><label>ã‚«ãƒ†ã‚´ãƒª: <input type="text" class="form-control" name="category_keywords" id="edit_category"></label></div>
          <div class="mb-2"><label>èª¬æ˜: <textarea class="form-control" name="description" id="edit_description"></textarea></label></div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">ä¿å­˜</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é–‰ã˜ã‚‹</button>
        </div>
      </div>
    </form>
  </div>
</div>
